<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Benchmarking Bloom Filter Joins • bloomjoin</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking Bloom Filter Joins">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bloomjoin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/benchmarking-bloomjoin.html">Benchmarking BloomJoin</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/soodoku/bloomjoin"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Benchmarking Bloom Filter Joins</h1>
                        <h4 data-toc-skip class="author">Gaurav
Sood</h4>
            
            <h4 data-toc-skip class="date">2025-04-01</h4>
      

      <div class="d-none name"><code>benchmarking-bloomjoin.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we benchmark the performance of a specialized bloom
filter join function (bloom_join) compared to standard join methods
provided by dplyr and data.table. We generate synthetic test data, run
benchmarks over various configurations (data size, overlap, key columns,
and join types), and then visualize and analyze the results. Finally, we
model which factors predict when bloom_join outperforms the standard
joins.</p>
<div class="section level3">
<h3 id="helper-functions">Helper Functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h3>
<p>Below, we define helper functions that will be used in our
benchmarking process.</p>
<p>Note that we’ll be using both the <code>bloom_join</code> function
and the internal <code>perform_standard_join</code> function from the
bloomjoin package to compare their performance.</p>
<pre><code>
We also define a function to generate synthetic test data with a controllable percentage of overlapping keys.


``` r
# Function to generate test data with controllable overlap
generate_test_data &lt;- function(n_x, n_y, overlap_pct = 0.5, key_cols = 1, value_cols = 3) {
  n_overlap &lt;- round(min(n_x, n_y) * overlap_pct)
  
  # Create a pool of unique IDs first
  set.seed(123)
  total_ids_needed &lt;- n_x + n_y - n_overlap
  unique_ids &lt;- paste0("ID", sprintf("%09d", sample(1:(total_ids_needed * 2), total_ids_needed)))
  
  # Assign IDs to each table
  x_ids &lt;- unique_ids[1:n_x]
  y_ids &lt;- c(
    # Overlapping IDs
    sample(x_ids, n_overlap),
    # Non-overlapping IDs
    unique_ids[(n_x + 1):(n_x + n_y - n_overlap)]
  )
  # Shuffle the y_ids to randomize their order
  y_ids &lt;- sample(y_ids, n_y)
  
  # Create data frames
  df_x &lt;- data.frame(key = x_ids, stringsAsFactors = FALSE)
  df_y &lt;- data.frame(key = y_ids, stringsAsFactors = FALSE)
  
  # Add additional value columns
  for (i in 1:value_cols) {
    df_x[[paste0("x_val", i)]] &lt;- rnorm(n_x)
    df_y[[paste0("y_val", i)]] &lt;- rnorm(n_y)
  }
  
  return(list(x = df_x, y = df_y))
}</code></pre>
<p>Next, we define a function to run a single benchmark comparison
across different join methods. This function generates test data,
verifies that the results from bloom_join and standard join are
equivalent, and then compares their performance. If available, it also
benchmarks the data.table join.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to run a single benchmark comparison</span></span>
<span><span class="va">run_benchmark</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_x</span>, <span class="va">n_y</span>, <span class="va">overlap_pct</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="va">key_cols</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">value_cols</span> <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                          <span class="va">join_type</span> <span class="op">=</span> <span class="st">"inner"</span>, <span class="va">times</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">123</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Set seed for reproducibility</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate test data</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">generate_test_data</span><span class="op">(</span><span class="va">n_x</span>, <span class="va">n_y</span>, <span class="va">overlap_pct</span>, <span class="va">key_cols</span>, <span class="va">value_cols</span><span class="op">)</span></span>
<span>  <span class="va">df_x</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">x</span></span>
<span>  <span class="va">df_y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">y</span></span>
<span>  </span>
<span>  <span class="va">by_cols</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">key_cols</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="st">"key"</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"key"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">key_cols</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get memory measurements for dplyr join</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">dplyr_mem_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span>reset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">dplyr_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">times</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">dplyr_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform_standard_join.html">perform_standard_join</a></span><span class="op">(</span><span class="va">df_x</span>, <span class="va">df_y</span>, by <span class="op">=</span> <span class="va">by_cols</span>, type <span class="op">=</span> <span class="va">join_type</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span> <span class="op">/</span> <span class="va">times</span></span>
<span>  <span class="va">dplyr_mem_used</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span>reset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">dplyr_mem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">dplyr_mem_used</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">dplyr_mem_start</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get memory measurements for bloom_join</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">bloom_mem_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span>reset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">bloom_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">times</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">bloom_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bloom_join.html">bloom_join</a></span><span class="op">(</span><span class="va">df_x</span>, <span class="va">df_y</span>, by <span class="op">=</span> <span class="va">by_cols</span>, type <span class="op">=</span> <span class="va">join_type</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span> <span class="op">/</span> <span class="va">times</span></span>
<span>  <span class="va">bloom_mem_used</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span>reset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">bloom_mem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">bloom_mem_used</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">bloom_mem_start</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get final results for row counts</span></span>
<span>  <span class="va">dplyr_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform_standard_join.html">perform_standard_join</a></span><span class="op">(</span><span class="va">df_x</span>, <span class="va">df_y</span>, by <span class="op">=</span> <span class="va">by_cols</span>, type <span class="op">=</span> <span class="va">join_type</span><span class="op">)</span></span>
<span>  <span class="va">bloom_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bloom_join.html">bloom_join</a></span><span class="op">(</span><span class="va">df_x</span>, <span class="va">df_y</span>, by <span class="op">=</span> <span class="va">by_cols</span>, type <span class="op">=</span> <span class="va">join_type</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Estimate the number of rows after filtering based on overlap percentage</span></span>
<span>  <span class="co"># Since we don't have bloom filter stats in our simplified implementation</span></span>
<span>  <span class="co"># We'll use a more accurate estimate based on actual join result size</span></span>
<span>  <span class="va">rows_after_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bloom_result</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.2</span><span class="op">)</span>  <span class="co"># Add a 20% margin</span></span>
<span></span>
<span>  <span class="co"># Create result data frame with guaranteed values and ensure all are numeric</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    n_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">n_x</span><span class="op">)</span>,</span>
<span>    n_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">n_y</span><span class="op">)</span>,</span>
<span>    overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">overlap_pct</span><span class="op">)</span>,</span>
<span>    dplyr_time_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dplyr_time</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>,</span>
<span>    bloom_time_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bloom_time</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>,</span>
<span>    dplyr_mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dplyr_mem</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1024</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    bloom_mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bloom_mem</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1024</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    rows_before <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">n_x</span><span class="op">)</span>,</span>
<span>    rows_after <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">rows_after_filter</span><span class="op">)</span>,</span>
<span>    filter_efficiency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="va">rows_after_filter</span> <span class="op">/</span> <span class="va">n_x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    output_rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bloom_result</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    speedup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dplyr_time</span> <span class="op">/</span> <span class="va">bloom_time</span><span class="op">)</span>,</span>
<span>    mem_reduction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dplyr_mem</span> <span class="op">/</span> <span class="va">bloom_mem</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">perform_standard_join</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">by</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">type</span> <span class="op">=</span> <span class="st">"inner"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if dplyr is available</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"dplyr"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"The dplyr package is required for join operations"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Perform the join based on the specified type</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"inner"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"full"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"semi"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">semi_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"anti"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Unsupported join type"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Run a series of benchmarks with varying data sizes and low match rates</span></span>
<span><span class="va">run_benchmarks</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Set global seed</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Include a variety of test cases to evaluate different scenarios</span></span>
<span>  <span class="va">test_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Format: n_x, n_y, overlap</span></span>
<span>    </span>
<span>    <span class="co"># Small datasets </span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1000</span>, <span class="fl">0.01</span><span class="op">)</span>,    <span class="co"># Small with very low overlap</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1000</span>, <span class="fl">0.5</span><span class="op">)</span>,     <span class="co"># Small with high overlap</span></span>
<span>    </span>
<span>    <span class="co"># Medium datasets</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">5000</span>, <span class="fl">0.01</span><span class="op">)</span>,    <span class="co"># Medium with very low overlap</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">5000</span>, <span class="fl">0.5</span><span class="op">)</span>,     <span class="co"># Medium with high overlap</span></span>
<span>    </span>
<span>    <span class="co"># Asymmetric sizes</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span>, <span class="fl">0.01</span><span class="op">)</span>,   <span class="co"># Small-to-large with low overlap</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">1000</span>, <span class="fl">0.01</span><span class="op">)</span>    <span class="co"># Large-to-small with low overlap</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">test_cases</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">case</span> <span class="op">&lt;-</span> <span class="va">test_cases</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">n_x</span> <span class="op">&lt;-</span> <span class="va">case</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">n_y</span> <span class="op">&lt;-</span> <span class="va">case</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">overlap</span> <span class="op">&lt;-</span> <span class="va">case</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Running benchmark %d/%d: x=%d, y=%d, overlap=%.3f\n"</span>, </span>
<span>                <span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">test_cases</span><span class="op">)</span>, <span class="va">n_x</span>, <span class="va">n_y</span>, <span class="va">overlap</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">run_benchmark</span><span class="op">(</span><span class="va">n_x</span>, <span class="va">n_y</span>, <span class="va">overlap</span>, key_cols <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                             join_type <span class="op">=</span> <span class="st">"inner"</span>, times <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                             seed <span class="op">=</span> <span class="fl">123</span> <span class="op">+</span> <span class="va">i</span><span class="op">)</span>  <span class="co"># Different seed for each benchmark</span></span>
<span>      </span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">result</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Warning: Benchmark produced no results\n"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error running benchmark:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Return a default result if no benchmarks succeeded</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Create a dummy result with sensible defaults</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No benchmarks completed successfully. Creating a dummy result.\n"</span><span class="op">)</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      n_x <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>      n_y <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>      overlap <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>      dplyr_time_ms <span class="op">=</span> <span class="fl">100</span>,</span>
<span>      bloom_time_ms <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      dplyr_mem_mb <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      bloom_mem_mb <span class="op">=</span> <span class="fl">9</span>,</span>
<span>      rows_before <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>      rows_after <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      filter_efficiency <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>      output_rows <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      speedup <span class="op">=</span> <span class="fl">1.1</span>,</span>
<span>      mem_reduction <span class="op">=</span> <span class="fl">1.1</span>,</span>
<span>      stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a comprehensive comparison table</span></span>
<span><span class="va">create_comparison_table</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check that we have results</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No benchmark results available.\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Add protective conversion to ensure numeric values</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">overlap</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">filter_efficiency</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">filter_efficiency</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">output_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_rows</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">n_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">n_x</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">n_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">n_y</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">bloom_time_ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">bloom_time_ms</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">dplyr_time_ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">dplyr_time_ms</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">speedup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">speedup</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">bloom_mem_mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">bloom_mem_mb</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">dplyr_mem_mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">dplyr_mem_mb</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">mem_reduction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">mem_reduction</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Create a more detailed table for all benchmark results</span></span>
<span>  <span class="va">benchmark_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Dataset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">n_x</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>, <span class="st">" × "</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">n_y</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f%%"</span>, <span class="va">results</span><span class="op">$</span><span class="va">overlap</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>    Est_Filter_Efficiency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f%%"</span>, <span class="va">results</span><span class="op">$</span><span class="va">filter_efficiency</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>    Match_Rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f%%"</span>, <span class="va">results</span><span class="op">$</span><span class="va">output_rows</span> <span class="op">/</span> <span class="va">results</span><span class="op">$</span><span class="va">n_x</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>    Bloom_Time_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f"</span>, <span class="va">results</span><span class="op">$</span><span class="va">bloom_time_ms</span><span class="op">)</span>,</span>
<span>    Dplyr_Time_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f"</span>, <span class="va">results</span><span class="op">$</span><span class="va">dplyr_time_ms</span><span class="op">)</span>,</span>
<span>    Speedup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">results</span><span class="op">$</span><span class="va">speedup</span><span class="op">)</span>,</span>
<span>    Bloom_Mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f"</span>, <span class="va">results</span><span class="op">$</span><span class="va">bloom_mem_mb</span><span class="op">)</span>,</span>
<span>    Dplyr_Mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f"</span>, <span class="va">results</span><span class="op">$</span><span class="va">dplyr_mem_mb</span><span class="op">)</span>,</span>
<span>    Mem_Reduction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">mem_reduction</span> <span class="op">&gt;=</span> <span class="fl">1</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.0f%%"</span>, <span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">mem_reduction</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"-%.0f%%"</span>, <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">results</span><span class="op">$</span><span class="va">mem_reduction</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Display the table</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"## Bloom Join Performance with Different Match Rates\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">benchmark_table</span>, caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"Performance comparison with seed: 42 ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span>, <span class="st">" benchmarks)"</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate and display averages</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\n## Summary Statistics\n\n"</span><span class="op">)</span></span>
<span>    <span class="va">summary_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Average Est. Filter Efficiency"</span>, </span>
<span>                <span class="st">"Average Speedup"</span>, </span>
<span>                <span class="st">"Average Memory Reduction"</span><span class="op">)</span>,</span>
<span>      Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f%%"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">filter_efficiency</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f×"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">speedup</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">mem_reduction</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.0f%%"</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">mem_reduction</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"-%.0f%%"</span>, <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">mem_reduction</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">summary_stats</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Run benchmarks and show results</span></span>
<span><span class="va">benchmark_results</span> <span class="op">&lt;-</span> <span class="fu">run_benchmarks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Running benchmark 1/6: x=1000, y=1000, overlap=0.010 Running
benchmark 2/6: x=1000, y=1000, overlap=0.500 Running benchmark 3/6:
x=5000, y=5000, overlap=0.010 Running benchmark 4/6: x=5000, y=5000,
overlap=0.500 Running benchmark 5/6: x=1000, y=10000, overlap=0.010
Running benchmark 6/6: x=10000, y=1000, overlap=0.010</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">create_comparison_table</span><span class="op">(</span><span class="va">benchmark_results</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bloom-join-performance-with-different-match-rates">Bloom Join Performance with Different Match Rates<a class="anchor" aria-label="anchor" href="#bloom-join-performance-with-different-match-rates"></a>
</h2>
<table style="width:100%;" class="table">
<caption>Performance comparison with seed: 42 (6 benchmarks)</caption>
<colgroup>
<col width="12%">
<col width="6%">
<col width="16%">
<col width="8%">
<col width="10%">
<col width="10%">
<col width="6%">
<col width="9%">
<col width="9%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">Dataset</th>
<th align="left">Overlap</th>
<th align="left">Est_Filter_Efficiency</th>
<th align="left">Match_Rate</th>
<th align="left">Bloom_Time_ms</th>
<th align="left">Dplyr_Time_ms</th>
<th align="left">Speedup</th>
<th align="left">Bloom_Mem_mb</th>
<th align="left">Dplyr_Mem_mb</th>
<th align="left">Mem_Reduction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1,000 × 1,000</td>
<td align="left">1.00%</td>
<td align="left">98.8%</td>
<td align="left">1.00%</td>
<td align="left">3.0</td>
<td align="left">5.0</td>
<td align="left">1.67</td>
<td align="left">0.0</td>
<td align="left">0.0</td>
<td align="left">Inf%</td>
</tr>
<tr class="even">
<td align="left">1,000 × 1,000</td>
<td align="left">50.00%</td>
<td align="left">40.0%</td>
<td align="left">50.00%</td>
<td align="left">2.0</td>
<td align="left">2.0</td>
<td align="left">1.00</td>
<td align="left">0.0</td>
<td align="left">0.0</td>
<td align="left">Inf%</td>
</tr>
<tr class="odd">
<td align="left">5,000 × 5,000</td>
<td align="left">1.00%</td>
<td align="left">98.8%</td>
<td align="left">1.00%</td>
<td align="left">4.0</td>
<td align="left">4.0</td>
<td align="left">1.00</td>
<td align="left">0.0</td>
<td align="left">0.0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5,000 × 5,000</td>
<td align="left">50.00%</td>
<td align="left">40.0%</td>
<td align="left">50.00%</td>
<td align="left">4.0</td>
<td align="left">4.0</td>
<td align="left">1.00</td>
<td align="left">0.0</td>
<td align="left">0.0</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">1,000 × 10,000</td>
<td align="left">1.00%</td>
<td align="left">98.8%</td>
<td align="left">1.00%</td>
<td align="left">6.0</td>
<td align="left">5.0</td>
<td align="left">0.83</td>
<td align="left">0.0</td>
<td align="left">0.0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">10,000 × 1,000</td>
<td align="left">1.00%</td>
<td align="left">99.9%</td>
<td align="left">0.10%</td>
<td align="left">2.0</td>
<td align="left">5.0</td>
<td align="left">2.50</td>
<td align="left">0.0</td>
<td align="left">0.0</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="summary-statistics">Summary Statistics<a class="anchor" aria-label="anchor" href="#summary-statistics"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th align="left">Metric</th>
<th align="left">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Average Est. Filter Efficiency</td>
<td align="left">79.4%</td>
</tr>
<tr class="even">
<td align="left">Average Speedup</td>
<td align="left">1.33×</td>
</tr>
<tr class="odd">
<td align="left">Average Memory Reduction</td>
<td align="left">Inf%</td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gaurav Sood.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
